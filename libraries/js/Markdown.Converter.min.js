// The following text is included for historical reasons, but should
// be taken with a pinch of salt; it's not all true anymore.

//
// Wherever possible, Showdown is a straight, line-by-line port
// of the Perl version of Markdown.
//
// This is not a normal parser design; it's basically just a
// series of string substitutions.  It's hard to read and
// maintain this way,  but keeping Showdown close to the original
// design makes it easier to port new features.
//
// More importantly, Showdown behaves like markdown.pl in most
// edge cases.  So web applications can do client-side preview
// in Javascript, and then build identical HTML on the server.
//
// This port needs the new RegExp functionality of ECMA 262,
// 3rd Edition (i.e. Javascript 1.5).  Most modern web browsers
// should do fine.  Even with the new regular expression features,
// We do a lot of work to emulate Perl's regex functionality.
// The tricky changes in this file mostly have the "attacklab:"
// label.  Major or self-explanatory changes don't.
//
// Smart diff tools like Araxis Merge will be able to match up
// this file with markdown.pl in a useful way.  A little tweaking
// helps: in a copy of markdown.pl, replace "#" with "//" and
// replace "$text" with "text".  Be sure to ignore whitespace
// and line endings.
//
var Markdown
Markdown="object"==typeof exports&&"function"==typeof require?exports:{},function(){function t(t){return t}function e(){return!1}function n(){}function r(){}n.prototype={chain:function(e,n){var r=this[e]
if(!r)throw Error("unknown hook "+e)
this[e]=r===t?n:function(){var t=Array.prototype.slice.call(arguments,0)
return t[0]=r.apply(null,t),n.apply(null,t)}},set:function(t,e){if(!this[t])throw Error("unknown hook "+t)
this[t]=e},addNoop:function(e){this[e]=t},addFalse:function(t){this[t]=e}},Markdown.HookCollection=n,r.prototype={set:function(t,e){this["s_"+t]=e},get:function(t){return this["s_"+t]}},Markdown.Converter=function(){function t(t){return t=t.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(t,e,n,r,i,s){return e=e.toLowerCase(),M.set(e,E(n)),i?r:(s&&L.set(e,s.replace(/"/g,"&quot;")),"")})}function e(t){return t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,i),t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,i),t=t.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,i),t=t.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,i),t=t.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,i)}function i(t,e){var n=e
return n=n.replace(/^\n+/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(T.push(n)-1)+"K\n\n"}function s(t,n){t=O.preBlockGamut(t,D),t=f(t)
var r="<hr />\n"
return t=t.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),t=t.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),t=t.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),t=g(t),t=m(t),t=x(t),t=O.postBlockGamut(t,D),t=e(t),t=b(t,n)}function o(t){return t=O.preSpanGamut(t),t=y(t),t=a(t),t=N(t),t=p(t),t=h(t),t=_(t),t=t.replace(/~P/g,"://"),t=E(t),t=S(t),t=t.replace(/  +\n/g," <br>\n"),t=O.postSpanGamut(t)}function a(t){var e=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi
return t=t.replace(e,function(t){var e=t.replace(/(.)<\/?code>(?=.)/g,"$1`")
return e=I(e,"!"==t.charAt(1)?"\\`*_/":"\\`*_")})}function h(t){return t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c),t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c),t=t.replace(/(\[([^\[\]]+)\])()()()()()/g,c)}function c(t,e,n,r,i,s,o,a){void 0==a&&(a="")
var h=e,c=n.replace(/:\/\//g,"~P"),p=r.toLowerCase(),u=i,f=a
if(""==u)if(""==p&&(p=c.toLowerCase().replace(/ ?\n/g," ")),u="#"+p,void 0!=M.get(p))u=M.get(p),void 0!=L.get(p)&&(f=L.get(p))
else{if(!(h.search(/\(\s*\)$/m)>-1))return h
u=""}u=A(u),u=I(u,"*_")
var g='<a href="'+u+'"'
return""!=f&&(f=l(f),f=I(f,"*_"),g+=' title="'+f+'"'),g+=">"+c+"</a>"}function p(t){return t=t.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,u),t=t.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,u)}function l(t){return t.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function u(t,e,n,r,i,s,o,a){var h=e,c=n,p=r.toLowerCase(),u=i,f=a
if(f||(f=""),""==u){if(""==p&&(p=c.toLowerCase().replace(/ ?\n/g," ")),u="#"+p,void 0==M.get(p))return h
u=M.get(p),void 0!=L.get(p)&&(f=L.get(p))}c=I(l(c),"*_[]()"),u=I(u,"*_")
var g='<img src="'+u+'" alt="'+c+'"'
return f=l(f),f=I(f,"*_"),g+=' title="'+f+'"',g+=" />"}function f(t){return t=t.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(t,e){return"<h1>"+o(e)+"</h1>\n\n"}),t=t.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(t,e){return"<h2>"+o(e)+"</h2>\n\n"}),t=t.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(t,e,n){var r=e.length
return"<h"+r+">"+o(n)+"</h"+r+">\n\n"})}function g(t,e){t+="~0"
var n=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm
return R?t=t.replace(n,function(t,n,r){var i=n,s=r.search(/[*+-]/g)>-1?"ul":"ol",o=d(i,s,e)
return o=o.replace(/\s+$/,""),o="<"+s+">"+o+"</"+s+">\n"}):(n=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,t=t.replace(n,function(t,e,n,r){var i=e,s=n,o=r.search(/[*+-]/g)>-1?"ul":"ol",a=d(s,o)
return a=i+"<"+o+">\n"+a+"</"+o+">\n"})),t=t.replace(/~0/,"")}function d(t,e,n){R++,t=t.replace(/\n{2,}$/,"\n"),t+="~0"
var r=V[e],i=RegExp("(^[ \\t]*)("+r+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+r+")[ \\t]+))","gm"),a=!1
return t=t.replace(i,function(t,e,r,i){var h=i,c=/\n\n$/.test(h),p=c||h.search(/\n{2,}/)>-1
return p||a?h=s(C(h),!0):(h=g(C(h),!0),h=h.replace(/\n$/,""),n||(h=o(h))),a=c,"<li>"+h+"</li>\n"}),t=t.replace(/~0/g,""),R--,t}function m(t){return t+="~0",t=t.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(t,e,n){var r=e,i=n
return r=k(C(r)),r=$(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>","\n\n"+r+"\n\n"+i}),t=t.replace(/~0/,"")}function v(t){return t=t.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(T.push(t)-1)+"K\n\n"}function y(t){return t=t.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(t,e,n,r){var i=r
return i=i.replace(/^([ \t]*)/g,""),i=i.replace(/[ \t]*$/g,""),i=k(i),i=i.replace(/:\/\//g,"~P"),e+"<code>"+i+"</code>"})}function k(t){return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=I(t,"*_{}[]\\",!1)}function S(t){return t=t.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),t=t.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}function x(t){return t=t.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(t,e){var n=e
return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=s(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(t,e){var n=e
return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),v("<blockquote>\n"+n+"\n</blockquote>")})}function b(t,e){t=t.replace(/^\n+/g,""),t=t.replace(/\n+$/g,"")
for(var n=t.split(/\n{2,}/g),r=[],i=/~K(\d+)K/,s=n.length,a=0;s>a;a++){var h=n[a]
i.test(h)?r.push(h):/\S/.test(h)&&(h=o(h),h=h.replace(/^([ \t]*)/g,"<p>"),h+="</p>",r.push(h))}if(!e){s=r.length
for(var a=0;s>a;a++)for(var c=!0;c;)c=!1,r[a]=r[a].replace(/~K(\d+)K/g,function(t,e){return c=!0,T[e]})}return r.join("\n\n")}function E(t){return t=t.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),t=t.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;")}function N(t){return t=t.replace(/\\(\\)/g,H),t=t.replace(/\\([`*_{}\[\]()>#+-.!])/g,H)}function w(t,e,n,r){if(e)return t
if(")"!==r.charAt(r.length-1))return"<"+n+r+">"
for(var i=r.match(/[()]/g),s=0,o=0;o<i.length;o++)"("===i[o]?0>=s?s=1:s++:s--
var a=""
if(0>s){var h=RegExp("\\){1,"+-s+"}$")
r=r.replace(h,function(t){return a=t,""})}if(a){var c=r.charAt(r.length-1)
q.test(c)||(a=c+a,r=r.substr(0,r.length-1))}return"<"+n+r+">"+a}function _(t){t=t.replace(G,w)
var e=function(t,e){return'<a href="'+e+'">'+O.plainLinkText(e)+"</a>"}
return t=t.replace(/<((https?|ftp):[^'">\s]+)>/gi,e)}function P(t){return t=t.replace(/~E(\d+)E/g,function(t,e){var n=parseInt(e)
return String.fromCharCode(n)})}function C(t){return t=t.replace(/^(\t|[ ]{1,4})/gm,"~0"),t=t.replace(/~0/g,"")}function $(t){if(!/\t/.test(t))return t
var e,n=["    ","   ","  "," "],r=0
return t.replace(/[\n\t]/g,function(t,i){return"\n"===t?(r=i+1,t):(e=(i-r)%4,r=i+1,n[e])})}function A(t){if(!t)return""
var e=t.length
return t.replace(F,function(n,r){return"~D"==n?"%24":":"!=n||r!=e-1&&!/[0-9\/]/.test(t.charAt(r+1))?"%"+n.charCodeAt(0).toString(16):":"})}function I(t,e,n){var r="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])"
n&&(r="\\\\"+r)
var i=RegExp(r,"g")
return t=t.replace(i,H)}function H(t,e){var n=e.charCodeAt(0)
return"~E"+n+"E"}var O=this.hooks=new n
O.addNoop("plainLinkText"),O.addNoop("preConversion"),O.addNoop("postNormalization"),O.addNoop("preBlockGamut"),O.addNoop("postBlockGamut"),O.addNoop("preSpanGamut"),O.addNoop("postSpanGamut"),O.addNoop("postConversion")
var M,L,T,R
this.makeHtml=function(n){if(M)throw Error("Recursive call to converter.makeHtml")
return M=new r,L=new r,T=[],R=0,n=O.preConversion(n),n=n.replace(/~/g,"~T"),n=n.replace(/\$/g,"~D"),n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),n="\n\n"+n+"\n\n",n=$(n),n=n.replace(/^[ \t]+$/gm,""),n=O.postNormalization(n),n=e(n),n=t(n),n=s(n),n=P(n),n=n.replace(/~D/g,"$$"),n=n.replace(/~T/g,"~"),n=O.postConversion(n),T=L=M=null,n}
var D=function(t){return s(t)},V={ol:"\\d+[.]",ul:"[*+-]"},j="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",B="[-A-Z0-9+&@#/%=~_|[\\])]",G=RegExp('(="|<)?\\b(https?|ftp)(://'+j+"*"+B+")(?=$|\\W)","gi"),q=RegExp(B,"i"),F=/(?:["'*()[\]:]|~D)/g}}();
